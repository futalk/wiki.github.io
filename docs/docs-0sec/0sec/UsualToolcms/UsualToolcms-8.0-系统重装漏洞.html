<html><head><meta charset="utf-8" /><style>.pydocx-caps {text-transform:uppercase}.pydocx-center {text-align:center}.pydocx-comment {color:blue}.pydocx-delete {color:red;text-decoration:line-through}.pydocx-hidden {visibility:hidden}.pydocx-insert {color:green}.pydocx-left {text-align:left}.pydocx-list-style-type-cardinalText {list-style-type:decimal}.pydocx-list-style-type-decimal {list-style-type:decimal}.pydocx-list-style-type-decimalEnclosedCircle {list-style-type:decimal}.pydocx-list-style-type-decimalEnclosedFullstop {list-style-type:decimal}.pydocx-list-style-type-decimalEnclosedParen {list-style-type:decimal}.pydocx-list-style-type-decimalZero {list-style-type:decimal-leading-zero}.pydocx-list-style-type-lowerLetter {list-style-type:lower-alpha}.pydocx-list-style-type-lowerRoman {list-style-type:lower-roman}.pydocx-list-style-type-none {list-style-type:none}.pydocx-list-style-type-ordinalText {list-style-type:decimal}.pydocx-list-style-type-upperLetter {list-style-type:upper-alpha}.pydocx-list-style-type-upperRoman {list-style-type:upper-roman}.pydocx-right {text-align:right}.pydocx-small-caps {font-variant:small-caps}.pydocx-strike {text-decoration:line-through}.pydocx-tab {display:inline-block;width:4em}.pydocx-underline {text-decoration:underline}body {margin:0px auto}</style></head><body><h1>UsualToolcms 8.0 系统重装漏洞</h1><h2>一、漏洞简介</h2><p>无验证, 在安装cms完成后 并不会自动删除文件 又不会生成lock来判断是否安装过了。 导致了可以直接重装过 setup/index.php 安装地址</p><h2>二、漏洞影响</h2><p>UsualToolCMS大众版5.0</p><p>UsualToolcms 8.0</p><h2>三、复现过程</h2><p>&lt;?php<br />$t=$_GET["t"];<br />$l=$_GET["l"];<br />$dbcontent=file_get_contents("../sql_db.php");<br />if($t=="db"){<br />$sqlcontent=$_POST["sqlcontent"];<br />file_put_contents("../sql_db.php",$sqlcontent);<br />echo &quot;&lt;script&gt;alert('数据库设置成功!');window.location.href='?l=sql'&lt;/script&gt;&quot;;<br />}<br />if($t=="testdb"){<br />$dbhost=$_POST["dbhost"];<br />$dbname=$_POST["dbname"];<br />$dbuser=$_POST["dbuser"];<br />$dbpass=$_POST["dbpass"];<br />$mysqli=new mysqli($dbhost,$dbuser,$dbpass,$dbname);<br />echo &quot;&lt;script&gt;alert('测试完成!&quot;.$mysqli-&gt;connect_error.&quot;');window.location.href='?l=sqlback'&lt;/script&gt;&quot;;<br />}<br />if($t=="sqlback"){<br />include('../sql_db.php');<br />$sqlcontent=$_POST['sqlcontent'];<br />$res=$mysqli -&gt; multi_query($sqlcontent);<br />echo &quot;&lt;script&gt;alert('数据库结构规划完成!');window.location.href='?l=setup'&lt;/script&gt;&quot;;<br />}<br />if($t=="update"){<br />include('../sql_db.php');<br />$authcode=$_POST["authcode"];$webname=$_POST["webname"];<br />$weblogo=$_POST["weblogo"];<br />$weburl=$_POST["weburl"];<br />$template=$_POST["template"];<br />$webisclose=$_POST["webisclose"];<br />$develop=$_POST["develop"];<br />$articlelistnum=$_POST["articlelistnum"];<br />$indexarticlenum=$_POST["indexarticlenum"];<br />$indexarticlerenum=$_POST["indexarticlerenum"];<br />$articlehitnum=$_POST["articlehitnum"];<br />$goodslistnum=$_POST["goodslistnum"];<br />$indexgoodsnum=$_POST["indexgoodsnum"];<br />$indexgoodsrenum=$_POST["indexgoodsrenum"];<br />$goodshitnum=$_POST["goodshitnum"];<br />$article=$_POST["article"];<br />$goods=$_POST["goods"];<br />$messagebook=$_POST["messagebook"];<br />$orders=$_POST["orders"];<br />$members=$_POST["members"];<br />$usercookname=$_POST["usercookname"];<br />$sqls=&quot;INSERT INTO `cms_setup` (authcode,webname,weblogo,weburl,template,webisclose,develop,articlelistnum,indexarticlenum, indexarticlerenum,articlehitnum,goodslistnum,indexgoodsnum,indexgoodsrenum,goodshitnum,article,goods,messagebook,orders,members,usercookname,installtime) VALUES ('$authcode','$webname','$weblogo','$weburl','$template','$webisclose','$develop','$articlelistnum','$indexarticlenum','$indexarticlerenum','$articlehitnum','$goodslistnum','$indexgoodsnum','$indexgoodsrenum','$goodshitnum','$article','$goods','$messagebook','$orders','$members','$usercookname',now())&quot;;<br />if ($mysqli-&gt;query($sqls) == TRUE) {<br />echo &quot;&lt;script&gt;alert('基础设置完成!');window.location.href='?l=welcome'&lt;/script&gt;&quot;;<br />}else{<br />echo &quot;&lt;script&gt;alert('未设置成功!请重填!');window.location.href='?l=setup'&lt;/script&gt;&quot;;<br />}<br />}?&gt;</p><p>UsualToolcsm需要先设置数据库账号密码才可以安装sql_db.php文件。</p><p>这边是判断数据库连接是否成功，</p><p>如果成功执行下一步，</p><p>如果不成功反回未设置成功!请重填</p><p>p:437-438</p><p>成功安装以后反回一个默认账号密码</p><p>echo"&lt;li&gt;&lt;span&gt;后台默认账号: &lt;/span&gt;usualtool&lt;/li&gt;";<br />echo"&lt;li&gt;&lt;span&gt;后台默认密码: &lt;/span&gt;123456&lt;/li&gt;";</p><p>直接下一步就可以因为sql_db.php是提前设置好账号密码的</p><p><a href="http://0-sec.org/UsualToolCMS/setup/">http://0-sec.org/UsualToolCMS/setup/</a></p><p>image</p></body></html>